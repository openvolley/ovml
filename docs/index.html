<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Machine Learning Tools for Volleyball • ovml</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Machine Learning Tools for Volleyball">
<meta property="og:description" content="Image and video machine learning tools, for application to volleyball analytics.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">ovml</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.15</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="ovml">ovml<a class="anchor" aria-label="anchor" href="#ovml"></a>
</h1></div>
<!-- badges: start -->

<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## install.packages("remotes")</span>
<span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"openvolley/ovml"</span><span class="op">)</span></code></pre></div>
<p>The <code>ovml</code> package provides image and video machine
learning tools for volleyball analytics. See also the <a href="https://github.com/openvolley/opensportml" class="external-link">opensportml</a> for a
generalized version of this package for use with other sports.</p>
<p>Currently two versions of the <a href="https://pjreddie.com/darknet/yolo/" class="external-link">YOLO</a> object detection
algorithm are included. These have been implemented on top of the <a href="https://torch.mlverse.org/" class="external-link">torch</a> R package, meaning that no
Python installation is required on your system.</p>
<p>The package also includes an experimental network specifically for
detecting volleyballs.</p>
<p>This implementation drew from <a href="https://github.com/ayooshkathuria/pytorch-yolo-v3" class="external-link">ayooshkathuria/pytorch-yolo-v3</a>,
<a href="https://github.com/walktree/libtorch-yolov3" class="external-link">walktree/libtorch-yolov3</a>,
<a href="https://github.com/rockyzhengwu/libtorch-yolov4" class="external-link">rockyzhengwu/libtorch-yolov4</a>,
and <a href="https://github.com/gwinndr/YOLOv4-Pytorch" class="external-link">gwinndr/YOLOv4-Pytorch</a>.</p>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>Use a YOLOv4 network to recognize objects in an image. We use a video
frame image (bundled with the package):</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">ovml</span><span class="op">)</span>
<span class="va">img</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ovml_example_image.html">ovml_example_image</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="reference/ovml_plot.html">ovml_ggplot</a></span><span class="op">(</span><span class="va">img</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-ex1-1.png" width="100%"></p>
<p>Construct the network. The first time this function is run, it will
download and cache the network weights file (~250MB).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dn</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ovml_yolo.html">ovml_yolo</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Now we can use the network to detect objects in our image:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dets</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ovml_yolo_detect.html">ovml_yolo_detect</a></span><span class="op">(</span><span class="va">dn</span>, <span class="va">img</span>, conf <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span>
<span class="va">dets</span> <span class="op">&lt;-</span> <span class="va">dets</span><span class="op">[</span><span class="va">dets</span><span class="op">$</span><span class="va">class</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"person"</span>, <span class="st">"sports ball"</span><span class="op">)</span>, <span class="op">]</span>
<span class="fu"><a href="reference/ovml_plot.html">ovml_ggplot</a></span><span class="op">(</span><span class="va">img</span>, <span class="va">dets</span><span class="op">)</span>
<span class="co">#&gt; Warning: Removed 1 rows containing missing values (geom_rect).</span></code></pre></div>
<p><img src="reference/figures/README-ex3-1.png" width="100%"></p>
<p>Note that this network didn’t detect the volleyball (in the process
of being contacted by the server). Let’s try the experimental
volleyball-specific network:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dn</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ovml_yolo.html">ovml_yolo</a></span><span class="op">(</span><span class="st">"4-mvb"</span><span class="op">)</span>
<span class="va">ball_dets</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ovml_yolo_detect.html">ovml_yolo_detect</a></span><span class="op">(</span><span class="va">dn</span>, <span class="va">img</span><span class="op">)</span>
<span class="fu"><a href="reference/ovml_plot.html">ovml_ggplot</a></span><span class="op">(</span><span class="va">img</span>, <span class="va">ball_dets</span>, label_geom <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="co">## don't add the label, it obscures the volleyball</span></code></pre></div>
<p><img src="reference/figures/README-ex4-1.png" width="100%"></p>
<p>We can transform the image detections to real-world court
coordinates. First we need to define the court reference points needed
for the transformation. We can use the <code>ov_shiny_court_ref</code>
helper app for this:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/openvolley/ovideo" class="external-link">ovideo</a></span><span class="op">)</span>
<span class="va">ref</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ovideo/man/ov_shiny_court_ref.html" class="external-link">ov_shiny_court_ref</a></span><span class="op">(</span><span class="va">img</span><span class="op">)</span></code></pre></div>
<p><code>ref</code> should look something like:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ref</span>
<span class="co">#&gt; $antenna</span>
<span class="co">#&gt; # A tibble: 4 x 4</span>
<span class="co">#&gt;   image_x image_y antenna where  </span>
<span class="co">#&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;  </span>
<span class="co">#&gt; 1   0.208   0.348 left    floor  </span>
<span class="co">#&gt; 2   0.82    0.353 right   floor  </span>
<span class="co">#&gt; 3   0.823   0.641 right   net_top</span>
<span class="co">#&gt; 4   0.2     0.643 left    net_top</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $video_width</span>
<span class="co">#&gt; [1] 1280</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $video_height</span>
<span class="co">#&gt; [1] 720</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $video_framerate</span>
<span class="co">#&gt; [1] 30</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $net_height</span>
<span class="co">#&gt; [1] 2.43</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $court_ref</span>
<span class="co">#&gt; # A tibble: 4 x 4</span>
<span class="co">#&gt;   image_x image_y court_x court_y</span>
<span class="co">#&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1  0.0549  0.0221     0.5     0.5</span>
<span class="co">#&gt; 2  0.953   0.0233     3.5     0.5</span>
<span class="co">#&gt; 3  0.751   0.52       3.5     6.5</span>
<span class="co">#&gt; 4  0.289   0.516      0.5     6.5</span></code></pre></div>
<p>Now use it with the <code>ov_transform_points</code> function (note
that currently this function expects the image coordinates to be
normalized with respect to the image width and height):</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">court_xy</span> <span class="op">&lt;-</span> <span class="fu">ovideo</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ovideo/man/ov_transform_points.html" class="external-link">ov_transform_points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">(</span><span class="va">dets</span><span class="op">$</span><span class="va">xmin</span> <span class="op">+</span> <span class="va">dets</span><span class="op">$</span><span class="va">xmax</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span> <span class="op">/</span> <span class="va">ref</span><span class="op">$</span><span class="va">video_width</span>,
                                        y <span class="op">=</span> <span class="va">dets</span><span class="op">$</span><span class="va">ymin</span> <span class="op">/</span> <span class="va">ref</span><span class="op">$</span><span class="va">video_height</span>,
                                        ref <span class="op">=</span> <span class="va">ref</span><span class="op">$</span><span class="va">court_ref</span>, direction <span class="op">=</span> <span class="st">"to_court"</span><span class="op">)</span>
<span class="va">dets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">dets</span>, <span class="va">court_xy</span><span class="op">)</span></code></pre></div>
<p>And plot it:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">datavolley</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dets</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/datavolley/man/ggcourt.html" class="external-link">ggcourt</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="cn">NULL</span>, court_colour <span class="op">=</span> <span class="st">"indoor"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-ex8-1.png" width="100%"></p>
<p>Keep in mind that <code>ov_transform_points</code> is using the
middle-bottom of each bounding box and transforming it assuming that
this represents a point on the court surface (the floor). Locations
associated with truncated object boxes, or objects not on the court
surface (players jumping, people in elevated positions such as the
referee’s stand) will appear further away from the camera than they
actually are.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing ovml</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Ben Raymond <br><small class="roles"> Author, maintainer </small>  </li>
<li>Adrien Ickowicz <br><small class="roles"> Author </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://www.tidyverse.org/lifecycle/#experimental" class="external-link"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="lifecycle"></a></li>
<li><a href="https://github.com/openvolley/ovml/actions" class="external-link"><img src="https://github.com/openvolley/ovml/workflows/R-CMD-check/badge.svg" alt="R build status"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Ben Raymond, Adrien Ickowicz.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a>
2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
